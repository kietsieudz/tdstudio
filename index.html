<!doctype html>
<html lang="vi" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <meta name="robots" content="index, follow, max-image-preview:large" />
    <meta name="author" content="TDStudio" />
    <meta name="format-detection" content="telephone=no,address=no,email=no" />
    <meta http-equiv="content-language" content="vi,en,id" />

    <!-- Preconnects -->
    <link rel="preconnect" href="https://thanhdi.com" crossorigin />
    <link rel="dns-prefetch" href="//thanhdi.com" />

    <!-- Canonical & hreflang (will be normalized by JS based on ?lang=) -->
    <link id="canonical" rel="canonical" href="https://thanhdi.com/" />
    <link rel="alternate" hreflang="vi" href="https://thanhdi.com/?lang=vi" />
    <link rel="alternate" hreflang="en" href="https://thanhdi.com/?lang=en" />
    <link rel="alternate" hreflang="id" href="https://thanhdi.com/?lang=id" />
    <link rel="alternate" hreflang="x-default" href="https://thanhdi.com/" />

    <!-- Base SEO -->
    <title id="seo-title">TDStudio – Trang chủ chính thức cộng đồng Ngọc
      Rồng</title>
    <meta id="seo-desc" name="description"
      content="Trang chủ chính thức TDStudio: tổng hợp link server, box Zalo, Discord, Fanpage, Group Facebook. Chạm nhanh để vào game hoặc cộng đồng.">
    <noscript>
      <meta name="description"
        content="TDStudio – Trang chủ chính thức: tổng hợp link server, box Zalo, Discord, Fanpage, Group Facebook." />
    </noscript>

    <!-- ============ OPEN GRAPH / FACEBOOK / ZALO / DISCORD ============ -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="TDStudio" />
    <meta property="og:locale" content="vi_VN" />
    <meta property="og:locale:alternate" content="en_US" />
    <meta property="og:locale:alternate" content="id_ID" />

    <meta id="og-title" property="og:title"
      content="TDStudio – Trang chủ chính thức" />
    <meta id="og-desc" property="og:description"
      content="Trang chủ chính thức TDStudio – Liên kết server và cộng đồng." />
    <meta id="og-url" property="og:url" content="https://thanhdi.com/" />

    <!-- Ảnh xem trước (Open Graph Preview) -->
    <meta id="og-image" property="og:image"
      content="https://thanhdi.com/images/graph.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="TDStudio – Trang chủ chính thức" />

    <!-- ============ TWITTER CARD ============ -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@tdstudio" />
    <meta id="tw-title" name="twitter:title"
      content="TDStudio – Trang chủ chính thức" />
    <meta id="tw-desc" name="twitter:description"
      content="Trang chủ chính thức TDStudio – Liên kết server và cộng đồng." />
    <meta id="tw-image" name="twitter:image"
      content="https://thanhdi.com/images/graph.png" />
    <meta name="twitter:image:alt" content="TDStudio – Trang chủ chính thức" />

    <!-- ============ PWA / ICONS ============ -->
    <meta name="theme-color" content="#0c0a09" />
    <link rel="icon" href="images/favicon.ico" sizes="any" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Styles -->
    <style>
/* ===========================================================================
   TDStudio – Homepage (dark mặc định, i18n 3 ngôn ngữ)
   =========================================================================== */
*,*::before,*::after{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Roboto,Helvetica,Arial,sans-serif;line-height:1.6;color:var(--fg);background:var(--bg)}
a{color:inherit;text-decoration:none}
:root{
  --bg:#0c0a09;--surface:#1a1816;--fg:#e5e7eb;--fg-subtle:#a8a29e;
  --primary-400:#fb923c;--primary-500:#f97316;--primary-600:#ea580c;
  --accent-500:#22c55e;--border:rgba(245,158,11,.3);
  --r-md:.75rem;--fs-sm:.9rem;--fs-md:1rem;--fs-lg:1.15rem;--container:820px;
  --focus: 0 0 0 3px rgba(249,115,22,.45);
}
[data-theme="light"]{
  --bg:#fff7ed;--surface:#fff;--fg:#111827;--fg-subtle:#6b7280;--border:rgba(249,115,22,.3);
}
:focus-visible{outline:none;box-shadow:var(--focus)}
.wrapper{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:1rem}
.sheet{width:100%;max-width:var(--container)}
.header{display:flex;flex-direction:column;align-items:flex-start;padding:1rem;margin-bottom:1rem;border:1px solid var(--border);border-radius:var(--r-md);background:var(--surface);box-shadow:0 2px 4px rgba(0,0,0,.2)}
.header-top{display:flex;align-items:center;gap:.6rem;width:100%}
.logo-img{width:46px;height:46px;border-radius:12px;object-fit:cover;border:1px solid var(--border)}
.site-name{font-weight:800;font-size:1.1rem}
.lang-row{margin-left:auto;display:flex;gap:.4rem}
.lang{padding:.3rem .6rem;border-radius:999px;border:1px solid var(--border);background:transparent;font-size:.85rem;cursor:pointer}
.lang[aria-current="true"] {
  background: color-mix(in oklab, var(--primary-500) 18%, var(--surface));
  border-color: var(--border);
  color: #fff; /* chữ trắng */
}

.nav{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.7rem}
.nav a{padding:.35rem .8rem;border-radius:999px;font-weight:600;font-size:.9rem;border:1px solid transparent;transition:.2s}
.nav a:hover{background:color-mix(in oklab,var(--primary-500) 20%, var(--surface));border-color:var(--border)}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-md);padding:1rem;margin-top:1rem}
.card h2{margin:0 0 .6rem;color:var(--primary-500);font-size:var(--fs-lg)}
.server-list{display:grid;gap:.5rem}
.server-item{display:flex;align-items:center;gap:.6rem;padding:.5rem .7rem;border:1px solid var(--border);border-radius:var(--r-md);background:var(--surface)}
.server-item .dot{width:9px;height:9px;border-radius:50%;background:var(--accent-500)}
.server-item .name{font-weight:700}
.server-item .info{margin-left:auto;color:var(--primary-400);font-weight:700;font-size:.9rem}
.chips{display:flex;flex-wrap:wrap;gap:.4rem}
.chip{display:inline-flex;align-items:center;height:30px;padding:0 .7rem;border-radius:999px;border:1px solid var(--border);background:var(--surface);font-size:.85rem;color:var(--fg-subtle)}
.chip:hover{background:color-mix(in oklab,var(--primary-500) 15%, var(--surface))}
.footer{margin-top:1.5rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;font-size:.85rem;color:var(--fg-subtle)}
.f-utils{display:flex;align-items:center;gap:.4rem}
.f-pill{padding:.25rem .6rem;border:1px solid var(--border);border-radius:999px;background:var(--surface);cursor:pointer}
.visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.skip-link{position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden}
.skip-link:focus{left:1rem;top:1rem;width:auto;height:auto;background:var(--surface);padding:.5rem .75rem;border-radius:.5rem;border:1px solid var(--border)}

/* ===== FAB Messenger + Hint bubble ===== */
#ndxMsgrFab{
  position:fixed; right:16px; bottom:16px; z-index:99998;
  width:56px; height:56px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  background:#0084ff; color:#fff; border:none; cursor:pointer;
  box-shadow:0 8px 24px rgba(0,0,0,.28), 0 2px 6px rgba(0,0,0,.2);
  transition:transform .15s ease, box-shadow .15s ease;
}
@media (max-width: 640px){
    #ndxMsgrFab{
      bottom: calc(88px + env(safe-area-inset-bottom, 0px)) !important;
    }
  }
#ndxMsgrFab:hover{ transform:translateY(-2px); box-shadow:0 10px 28px rgba(0,0,0,.34), 0 3px 8px rgba(0,0,0,.22) }
#ndxMsgrFab:active{ transform:translateY(0) scale(.98) }
.msgr-ic{width:28px;height:28px;display:block}
.msgr-ic svg{width:100%;height:100%;display:block;fill:#fff}
.msgr-badge{
  position:absolute; right:-2px; top:-2px; background:#ff3b30; color:#fff;
  width:20px; height:20px; border-radius:50%; font:700 12px/20px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  text-align:center; box-shadow:0 1px 0 rgba(0,0,0,.25)
}
#msgrHint{
  position:fixed; z-index:99997;
  right:88px; bottom:28px; /* sẽ được JS canh lại theo viewport */
  max-width:260px; background:#0ea5e9; color:#fff;
  border-radius:14px; padding:10px 12px; font:500 14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  box-shadow:0 12px 28px rgba(0,0,0,.25), 0 2px 6px rgba(0,0,0,.2);
  opacity:0; transform:translateY(6px); pointer-events:none; transition:opacity .2s ease, transform .2s ease;
}
#msgrHint.show{ opacity:1; transform:translateY(0); pointer-events:auto }
#msgrHint .txt{padding-right:16px}
#msgrHint .ndx-hint-close{
  position:absolute; right:6px; top:4px; background:transparent; border:none; color:#eaf6ff;
  font:700 14px/1 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; cursor:pointer; opacity:.85
}
#msgrHint .ndx-hint-close:hover{ opacity:1 }
#msgrHint:after{
  content:""; position:absolute; right:-8px; bottom:14px; width:0; height:0;
  border-left:8px solid #0ea5e9; border-top:8px solid transparent; border-bottom:8px solid transparent;
  filter:drop-shadow(0 2px 2px rgba(0,0,0,.18));
}
/* In-App warning bar (JS injects element with this class) */
.iab-warning{position:fixed;top:0;left:0;right:0;z-index:99999;background:#ffeeba;color:#111;padding:14px;text-align:center;
  font:700 16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;border-bottom:1px solid #e0c46c}
.iab-warning .btn-copy{font-weight:700;padding:8px 14px;margin-top:8px;border:1px solid #bfa34e;background:#ffd966;cursor:pointer;border-radius:6px}
.iab-warning .ok{margin-top:6px;font-weight:600;color:#0a7c2f;display:none}
@media (max-width:420px){ #msgrHint{max-width:220px} }
    </style>

    <!-- JSON-LD (will be patched to lang-specific URL by JS) -->
    <script type="application/ld+json" id="ld-org">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "TDStudio",
      "url": "https://thanhdi.com/",
      "logo": "https://thanhdi.com/images/logo.png",
      "sameAs": [
        "https://www.facebook.com/ngocrongnthevmax",
        "https://t.me/gdthanhdi",
        "https://discord.gg/jW8uBff4"
      ]
    }
    </script>
    <script type="application/ld+json" id="ld-site">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "TDStudio Official Homepage",
      "url": "https://thanhdi.com/",
      "inLanguage": "vi",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://thanhdi.com/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
  </head>
  <body>
    <a class="skip-link" href="#main">Bỏ qua nội dung</a>
    <div class="wrapper">
      <main class="sheet" id="main" itemscope
        itemtype="https://schema.org/WebSite">
        <header class="header" role="banner">
          <div class="header-top">
            <img src="images/logo.png" width="46" height="46"
              alt="TDStudio Logo" class="logo-img"
              itemprop="image" loading="lazy" />
            <span class="site-name" itemprop="name">TDStudio</span>
            <nav class="lang-row" aria-label="Language switcher">
              <button class="lang" data-lang="vi"
                aria-current="true" type="button">VI</button>
              <button class="lang" data-lang="en"
                type="button">EN</button>
              <button class="lang" data-lang="id"
                type="button">ID</button>
            </nav>
          </div>
          <nav class="nav" aria-label="Main navigation">
            <a href="#servers" data-i18n="nav_servers">Server</a>
            <a href="#communities" data-i18n="nav_communities">Cộng
              đồng</a>
            <a href="https://www.facebook.com/ngocrongnthevmax"
              data-i18n="nav_socials"
              aria-disabled="true">Fanpage</a>
          </nav>
        </header>

        <!-- Servers -->
        <section class="card" id="servers">
          <h2 data-i18n="sec_servers_title">Server luôn trực
            tuyến</h2>
          <p class="visually-hidden" data-i18n="sec_servers_desc">Danh
            sách server chính thức của TDStudio.</p>
          <div class="server-list" role="list">
            <a class="server-item" href="https://nroclan.com"
              rel="noopener" role="listitem">
              <span class="dot" aria-hidden="true"></span><span
                class="name">Server 1 (Clan)</span>
              <span class="info" data-i18n="cta_join"
                aria-label="Join Server 1">Tham gia</span>
            </a>
            <a class="server-item" href="https://nro3q.com"
              rel="noopener" role="listitem">
              <span class="dot" aria-hidden="true"></span><span
                class="name">Server 2 (3Q)</span>
              <span class="info" data-i18n="cta_join"
                aria-label="Join Server 2">Tham gia</span>
            </a>
            <a class="server-item" href="https://nromun.com"
              rel="noopener" role="listitem">
              <span class="dot" aria-hidden="true"></span><span
                class="name">Server 3 (Mun)</span>
              <span class="info" data-i18n="cta_join"
                aria-label="Join Server 3">Tham gia</span>
            </a>
            <a class="server-item" href="https://nroping.com"
              rel="noopener" role="listitem">
              <span class="dot" aria-hidden="true"></span><span
                class="name">Server 4 (Ping)</span>
              <span class="info" data-i18n="cta_join"
                aria-label="Join Server 4">Tham gia</span>
            </a>
            <a class="server-item" href="https://nrokid.com"
              rel="noopener" role="listitem">
              <span class="dot" aria-hidden="true"></span><span
                class="name">Server 5 (Kid)</span>
              <span class="info" data-i18n="cta_join"
                aria-label="Join Server 5">Tham gia</span>
            </a>
          </div>
        </section>

        <!-- Communities -->
        <section class="card" id="communities">
          <h2 data-i18n="sec_box_title">Box</h2>
          <div class="chips" aria-label="Zalo">
            <a class="chip" href="https://zalo.me/g/guxxky409"
              rel="nofollow">Zalo 1 – Server 1</a>
            <a class="chip" href="https://zalo.me/g/chhtoc951"
              rel="nofollow">Zalo 2 – Server 1</a>
            <a class="chip" href="https://zalo.me/g/pqaiqm424"
              rel="nofollow">Zalo 1 – Server 2</a>
            <a class="chip" href="https://zalo.me/g/crnbag894"
              rel="nofollow">Zalo 1 – Server 3</a>
            <a class="chip" href="https://zalo.me/g/gfnekq114"
              rel="nofollow">Zalo 1 – Server 4</a>
            <a class="chip" href="https://zalo.me/g/uelhmv606"
              rel="nofollow">Zalo 1 – Server 5</a>
            <a class="chip" href="https://zalo.me/g/vmtbba265"
              rel="nofollow">Zalo 2 – Server 5</a>
          </div>

          <h2 style="margin-top:1rem"
            data-i18n="sec_channels_title">Kênh theo khu vực</h2>
          <div class="chips">
            <a class="chip"
              href="https://chat.whatsapp.com/Hg4CqxRa31u9TCN8WbWSWy"
              rel="noopener">WhatsApp – Indonesia</a>
            <a class="chip" href="https://t.me/gdthanhdi"
              rel="noopener">Telegram</a>
            <a class="chip" href="https://discord.gg/jW8uBff4"
              rel="noopener">Discord</a>
            <a class="chip"
              href="https://www.facebook.com/groups/916049213653568"
              rel="noopener">Group Facebook</a>
            <a class="chip"
              href="https://www.facebook.com/ngocrongnthevmax"
              rel="noopener">Fanpage chính</a>
            <a class="chip"
              href="https://www.facebook.com/ngaidinro/"
              rel="noopener">Fanpage phụ</a>
            <a class="chip"
              href="https://www.facebook.com/ngocrongonlinevip"
              rel="noopener">Fanpage phụ</a>
          </div>
        </section>

        <footer class="footer">
          <small>© <span id="y"></span> TDStudio • <span
              data-i18n="footer_bio">Trang chủ chính
              thức</span></small>
          <div class="f-utils">
            <a class="f-pill" href="#"
              aria-label="Scroll to top">↑</a>
            <button class="f-pill" id="themeToggle" type="button"
              aria-live="polite">Theme</button>
          </div>
        </footer>
      </main>
    </div>

    <!-- FAB -->
    <button id="ndxMsgrFab" aria-label="Chat with TDStudio on Messenger">
      <span class="msgr-ic" aria-hidden="true">
        <svg viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"
          role="img" aria-hidden="true">
          <path
            d="M18 3C9.716 3 3 9.214 3 16.99c0 4.267 1.94 7.98 5.04 10.55.26.214.42.522.43.858l.09 2.69c.03.93 1 1.56 1.86 1.17l2.99-1.34c.27-.12.57-.13.85-.04 1.15.37 2.37.57 3.72.57 8.28 0 15-6.214 15-13.99S26.28 3 18 3zm8.28 10.9l-4.47 7.12c-.57.91-1.81 1.12-2.65.45l-2.86-2.26a1.83 1.83 0 0 0-2.28-.01l-3.08 2.35c-.73.56-1.78.2-2.02-.68l-1.3-4.67c-.26-.94.38-1.89 1.35-1.98l4.86-.47c.36-.03.7-.2.95-.47l4.07-4.36c.75-.8 2.06-.6 2.57.38l2.99 5.6c.25.47.23 1.04-.03 1.49z" />
        </svg>
      </span>
      <span class="msgr-badge" aria-hidden="true">1</span>
    </button>

    <!-- Hint bubble -->
    <div id="msgrHint" role="dialog" aria-live="polite" aria-hidden="true">
      <button class="ndx-hint-close" aria-label="Đóng">×</button>
      <div class="txt" id="msgrHintTxt">Chat “xin code” để nhận bộ
        giftcode xịn nhé!</div>
    </div>

    <!-- i18n + SEO sync -->
    <script>
/* ========================= i18n strings ========================= */
const I18N = {
  vi: {
    html_lang:'vi',
    title:'TDStudio – Trang chủ chính thức cộng đồng Ngọc Rồng Online',
    desc:'Trang chủ chính thức TDStudio: tổng hợp link server, box Zalo, Discord, Fanpage, Group Facebook. Chạm nhanh để vào game hoặc cộng đồng.',
    nav_servers:'Server',
    nav_communities:'Cộng đồng',
    nav_socials:'Fanpage',
    sec_servers_title:'Server luôn trực tuyến',
    sec_servers_desc:'Danh sách server chính thức của TDStudio.',
    sec_box_title:'Box',
    sec_channels_title:'Kênh theo khu vực',
    cta_join:'Tham gia',
    footer_bio:'Trang chủ chính thức',
    og_locale:'vi_VN',
    hint_text:'Chat <b>“xin code”</b> để nhận bộ giftcode xịn nhé!'
  },
  en: {
    html_lang:'en',
    title:'TDStudio – Official homepage for the Dragon Ball Online community',
    desc:'TDStudio official homepage: all servers, Zalo/Discord groups, and Facebook pages. Jump in fast to play or chat.',
    nav_servers:'Servers',
    nav_communities:'Communities',
    nav_socials:'Fanpages',
    sec_servers_title:'Servers always online',
    sec_servers_desc:'Official list of TDStudio servers.',
    sec_box_title:'Boxes',
    sec_channels_title:'Regional channels',
    cta_join:'Join',
    footer_bio:'Official homepage',
    og_locale:'en_US',
    hint_text:'Type <b>“code”</b> to get a giftcode bundle!'
  },
  id: {
    html_lang:'id',
    title:'TDStudio – Beranda resmi komunitas Dragon Ball Online',
    desc:'Beranda resmi TDStudio: semua server dan grup Zalo/Discord, serta halaman Facebook. Masuk cepat untuk bermain atau berdiskusi.',
    nav_servers:'Server',
    nav_communities:'Komunitas',
    nav_socials:'Fanpage',
    sec_servers_title:'Server selalu online',
    sec_servers_desc:'Daftar server resmi TDStudio.',
    sec_box_title:'Box',
    sec_channels_title:'Kanal regional',
    cta_join:'Gabung',
    footer_bio:'Beranda resmi',
    og_locale:'id_ID',
    hint_text:'Ketik <b>“kode”</b> untuk menerima paket giftcode!'
  }
};

/* ===== In-app warning i18n (templates) ===== */
const I18N_WARN = {
  vi: {
    bar: 'Bạn đang mở trang trên <b>{app}</b>. Hãy copy link và mở bằng <b>{browser}</b> để đăng ký/tải game.',
    copy: 'Copy link',
    copied: 'Đã copy! Mở bằng {browser} nhé.'
  },
  en: {
    bar: 'You are viewing this site inside <b>{app}</b>. Copy the link and open in <b>{browser}</b> to register/download the game.',
    copy: 'Copy link',
    copied: 'Copied! Open it in {browser}.'
  },
  id: {
    bar: 'Anda membuka situs ini di <b>{app}</b>. Salin tautan dan buka di <b>{browser}</b> untuk mendaftar/mengunduh game.',
    copy: 'Salin tautan',
    copied: 'Tersalin! Buka di {browser}.'
  }
};

/* ========================= Helpers ========================= */
const qs = new URLSearchParams(location.search);
const sysLang = (navigator.language || 'vi').slice(0,2).toLowerCase();
const desired = qs.get('lang') || (['vi','en','id'].includes(sysLang) ? sysLang : 'vi');
const pickLang = (l => ['vi','en','id'].includes(l)? l : 'vi')(desired);

function setMetaForLang(lang){
  const T = I18N[lang];
  // html lang
  document.documentElement.setAttribute('lang', T.html_lang);
  // Canonical + hreflang
  const origin = 'https://thanhdi.com';
  const base = origin + location.pathname.replace(/\/+$/,'/');
  const hrefLang = `${base}?lang=${lang}`;
  const canonicalEl = document.getElementById('canonical');
  canonicalEl.href = (lang === 'vi') ? base : hrefLang;
  document.querySelector('link[hreflang="vi"]').href = `${base}?lang=vi`;
  document.querySelector('link[hreflang="en"]').href = `${base}?lang=en`;
  document.querySelector('link[hreflang="id"]').href = `${base}?lang=id`;
  document.querySelector('link[hreflang="x-default"]').href = base;
  // Title + description
  document.title = T.title;
  document.getElementById('seo-title').textContent = T.title;
  document.getElementById('seo-desc').setAttribute('content', T.desc);
  // OG / Twitter
  document.querySelector('meta[property="og:locale"]').setAttribute('content', T.og_locale);
  document.getElementById('og-title').setAttribute('content', T.title);
  document.getElementById('og-desc').setAttribute('content', T.desc);
  document.getElementById('og-url').setAttribute('content', canonicalEl.href);
  document.getElementById('tw-title').setAttribute('content', T.title);
  document.getElementById('tw-desc').setAttribute('content', T.desc);
  // JSON-LD patches
  try {
    const org = JSON.parse(document.getElementById('ld-org').textContent);
    const site = JSON.parse(document.getElementById('ld-site').textContent);
    site.inLanguage = lang;
    site.url = canonicalEl.href;
    document.getElementById('ld-site').textContent = JSON.stringify(site);
    org.url = base;
    document.getElementById('ld-org').textContent = JSON.stringify(org);
  } catch(e) {}
}

function applyText(lang){
  const T = I18N[lang];
  // nav + sections
  document.querySelectorAll('[data-i18n="nav_servers"]').forEach(n=>n.textContent=T.nav_servers);
  document.querySelectorAll('[data-i18n="nav_communities"]').forEach(n=>n.textContent=T.nav_communities);
  document.querySelectorAll('[data-i18n="nav_socials"]').forEach(n=>n.textContent=T.nav_socials);
  document.querySelectorAll('[data-i18n="sec_servers_title"]').forEach(n=>n.textContent=T.sec_servers_title);
  document.querySelectorAll('[data-i18n="sec_servers_desc"]').forEach(n=>n.textContent=T.sec_servers_desc);
  document.querySelectorAll('[data-i18n="sec_box_title"]').forEach(n=>n.textContent=T.sec_box_title);
  document.querySelectorAll('[data-i18n="sec_channels_title"]').forEach(n=>n.textContent=T.sec_channels_title);
  document.querySelectorAll('[data-i18n="cta_join"]').forEach(n=>n.textContent=T.cta_join);
  document.querySelectorAll('[data-i18n="footer_bio"]').forEach(n=>n.textContent=T.footer_bio);
  // lang pills state
  document.querySelectorAll('.lang').forEach(btn=>btn.setAttribute('aria-current', String(btn.dataset.lang===lang)));
  // Messenger hint text
  const hintEl = document.getElementById('msgrHintTxt');
  if (hintEl) hintEl.innerHTML = T.hint_text;
}

// Initial
setMetaForLang(pickLang);
applyText(pickLang);

// Lang switch UI
document.querySelectorAll('.lang').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const lang = btn.dataset.lang;
    const url = new URL(location.href);
    url.searchParams.set('lang', lang);
    history.replaceState({}, '', url);
    setMetaForLang(lang);
    applyText(lang);
  });
});

// Footer year & theme toggle
document.getElementById('y').textContent = new Date().getFullYear();
const t = document.getElementById('themeToggle'); let m = 'dark';
const syncThemeBtn = () => t.textContent=`Theme: ${m}`;
syncThemeBtn();
t.onclick = () => { m = m==='dark'?'light':'dark'; document.documentElement.dataset.theme = m; syncThemeBtn(); };
    </script>

    <!-- Messenger Hint position + auto show -->
    <script>
(function(){
  const GAP_X = 12, GAP_Y = 6;
  const fab  = document.getElementById('ndxMsgrFab');
  const hint = document.getElementById('msgrHint');
  if (!fab || !hint) return;

  function placeHint(){
    const r = fab.getBoundingClientRect();
    const vv = window.visualViewport;
    let vw = window.innerWidth, vh = window.innerHeight, offX = 0, offY = 0;
    if (vv) { vw = vv.width; vh = vv.height; offX = vv.offsetLeft||0; offY = vv.offsetTop||0; }
    const right  = Math.max(0, (vw + offX) - r.left + GAP_X);
    const bottom = Math.max(0, (vh + offY) - r.bottom + GAP_Y);
    hint.style.right  = right + 'px';
    hint.style.bottom = bottom + 'px';
  }
  function showHint(){ hint.classList.add('show'); hint.setAttribute('aria-hidden','false'); placeHint(); }
  function hideHint(){ hint.classList.remove('show'); hint.setAttribute('aria-hidden','true'); }

  window.addEventListener('load', () => setTimeout(showHint, 1200), { once:true });
  ['resize','scroll','orientationchange','visibilitychange'].forEach(ev=>{
    window.addEventListener(ev, placeHint, { passive:true });
  });
  if (window.visualViewport){
    ['resize','scroll'].forEach(ev=>{
      window.visualViewport.addEventListener(ev, placeHint, { passive:true });
    });
  }
  hint.querySelector('.ndx-hint-close')?.addEventListener('click', hideHint);
  fab.addEventListener('click', hideHint);
})();
    </script>

    <!-- In-app browser warning + copy link (localized) -->
    <script>
(function(){
  const ua = navigator.userAgent || "";
  const isMessenger   = /Messenger|FBAN\/Messenger|FB_IAB/i.test(ua);
  const isFacebookApp = /(FBAN|FBAV|FB_IAB|FB4A|com\.facebook\.katana)/i.test(ua);
  const isInstagram   = /Instagram/i.test(ua);
  const isTikTok      = /TikTok/i.test(ua);
  const isZalo        = /Zalo|zclient|ZaloTheme/i.test(ua);
  const isLine        = /Line\/|LINE/i.test(ua);
  const isTwitterApp  = /\bTwitter|X\/\d+/i.test(ua);
  const isSnap        = /Snapchat/i.test(ua);

  const isAndroid = /Android/i.test(ua);
  const isIOS     = /iPhone|iPad|iPod/i.test(ua);

  const appName = isMessenger ? "Messenger"
               : isFacebookApp ? "Facebook"
               : isInstagram ? "Instagram"
               : isTikTok ? "TikTok"
               : isZalo ? "Zalo"
               : isLine ? "LINE"
               : isTwitterApp ? "X (Twitter)"
               : isSnap ? "Snapchat"
               : "";

  if (!appName) return;

  const qs = new URLSearchParams(location.search);
  const sysLang = (navigator.language || 'vi').slice(0,2).toLowerCase();
  const lang = qs.get('lang') || (['vi','en','id'].includes(sysLang) ? sysLang : 'vi');
  const L = I18N_WARN[lang] || I18N_WARN.vi;

  const suggest = isAndroid ? "Chrome" : (isIOS ? "Safari" : (lang==='en'?'your browser':'trình duyệt trên máy'));
  const bar = document.createElement("div");
  bar.className = "iab-warning";
  bar.setAttribute("role","alert");
  const msg = L.bar.replace('{app}', appName).replace('{browser}', suggest);
  bar.innerHTML = msg + '<br>' +
    '<button class="btn-copy" id="copyLinkBtn">'+L.copy+'</button>' +
    '<div class="ok" id="copyStatus">'+L.copied.replace('{browser}', suggest)+'</div>';
  document.body.appendChild(bar);
  document.body.style.marginTop = (bar.getBoundingClientRect().height) + "px";

  document.getElementById("copyLinkBtn").onclick = function(){
    const url = location.href;
    function done(){ document.getElementById("copyStatus").style.display = "block"; }
    function fallback(){
      const ta = document.createElement("textarea"); ta.value = url; document.body.appendChild(ta);
      ta.select(); document.execCommand("copy"); document.body.removeChild(ta); done();
    }
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(url).then(done, fallback);
    } else { fallback(); }
  };
})();
    </script>

    <!-- FAB click -> m.me (mobile) hoặc fanpage (desktop) -->
    <script>
(function () {
  const PAGE_USERNAME = "ngocrongnthevmax";
  const MME_URL = `https://m.me/${encodeURIComponent(PAGE_USERNAME)}`;
  const FANPAGE_URL = `https://facebook.com/${encodeURIComponent(PAGE_USERNAME)}`;

  const isMobileUA = () =>
    /Android|iPhone|iPad|iPod|IEMobile|Windows Phone|Mobile Safari|Mobile/i
      .test(navigator.userAgent || "");

  function handleClick(e) {
    e.preventDefault();
    if (isMobileUA()) window.location.href = MME_URL;
    else window.open(FANPAGE_URL, "_blank", "noopener,noreferrer");
  }

  const el = document.getElementById("ndxMsgrFab");
  if (el) el.addEventListener("click", handleClick, { passive: false });
})();
    </script>

    <!-- noscript i18n fallbacks -->
    <noscript>
      <link rel="alternate" hreflang="vi"
        href="https://thanhdi.com/?lang=vi" />
      <link rel="alternate" hreflang="en"
        href="https://thanhdi.com/?lang=en" />
      <link rel="alternate" hreflang="id"
        href="https://thanhdi.com/?lang=id" />
      <link rel="alternate" hreflang="x-default"
        href="https://thanhdi.com/" />
    </noscript>
  </body>
</html>
