<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Chat h·ªó tr·ª£ 1v1 Ng·ªçc R·ªìng Online | TDStudio</title>

    <meta name="description"
      content="Trang chat h·ªó tr·ª£ 1v1 Ng·ªçc R·ªìng Online t·∫°i TDStudio. Tr√≤ chuy·ªán tr·ª±c ti·∫øp v·ªõi chatbot v√† ƒë·ªôi ng≈© h·ªó tr·ª£ ƒë·ªÉ ƒë∆∞·ª£c gi·∫£i ƒë√°p nhanh ch√≥ng.">

    <style>
:root{
    --brand:#2563eb;
    --bg:#eef2f7;
    --card:#ffffff;
    --bot:#f1f5f9;
    --border:#e5e7eb;
    --text:#111827;
    --muted:#6b7280;
}

*{box-sizing:border-box}

body{
    margin:0;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:var(--bg);
}

/* ===== POPUP WRAP ===== */
.wrap{
    position:fixed;
    top:10%;
    bottom:10%;
    left:5%;
    right:5%;

    display:flex;
    flex-direction:column;

    background:var(--card);
    border-radius:20px;

    box-shadow:
        0 20px 40px rgba(0,0,0,.15),
        0 4px 10px rgba(0,0,0,.08);

    overflow:hidden;
}

/* ===== HEADER ===== */
.header{
    padding:14px 12px;
    background:linear-gradient(135deg,#020617,#0f172a);
    color:#fff;
    text-align:center;
}

.header .title{
    font-weight:700;
    font-size:15px;
}

.header .sub{
    font-size:12px;
    opacity:.8;
    margin-top:2px;
}

/* ===== CHAT ===== */
.chat{
    position:relative;
    display:flex;          /* ‚¨Ö th√™m */
    flex-direction:column; /* ‚¨Ö th√™m */
    flex:1;
    overflow-y:auto;
    padding:16px 12px;
    background:#f8fafc;
}

/* ===== MESSAGE ===== */
.msg{
    display:inline-block;
    max-width:82%;
    margin-bottom:6px;
    font-size:13.2px;
    line-height:1.35;
    word-wrap:break-word;
}


.msg.user{
    align-self:flex-end;      /* ‚¨Ö ƒë·∫©y sang ph·∫£i */
    background:var(--brand);
    color:#fff;
    padding:7px 12px;
    border-radius:16px 16px 4px 16px;
}

.msg.bot{
    align-self:flex-start;    /* ‚¨Ö gi·ªØ b√™n tr√°i */
    background:var(--bot);
    color:var(--text);
    padding:8px 12px;
    border-radius:16px 16px 16px 4px;
}

/* ===== BUTTONS ===== */
.buttons{
    margin:4px 0 10px;
    display:flex;
    flex-direction:column;
    gap:6px;

    align-items:flex-start;   /* ‚¨Ö √©p v·ªÅ b√™n tr√°i (phe bot) */
}
.msg.bot + .buttons{
    margin-top:2px;
}


.buttons a{
    display:inline-flex;          /* ‚¨Ö √¥m n·ªôi dung */
    align-items:center;
    justify-content:center;

    padding:7px 14px;             /* ‚¨Ö nh·ªè g·ªçn */
    font-size:13px;
    font-weight:600;

    border-radius:999px;
    background:#fff;
    border:1px solid var(--border);
    color:var(--brand);
    text-decoration:none;

    max-width:85%;
    white-space:nowrap;
}

.buttons a:active{
    transform:scale(.97);
}

/* ===== INPUT ===== */
.input{
    display:flex;
    gap:8px;
    padding:10px;
    border-top:1px solid var(--border);
    background:#fff;
}

.input input{
    flex:1;
    border:1px solid var(--border);
    border-radius:999px;
    padding:12px 14px;
    font-size:14px;
    outline:none;
}

.input input:focus{
    border-color:var(--brand);
}

.input button{
    border:none;
    background:var(--brand);
    color:#fff;
    padding:0 18px;
    border-radius:999px;
    font-size:14px;
    font-weight:600;
}

/* ===== EMPTY POPUP ===== */
.empty-popup{
    position:absolute;
    top:0;
    left:0;
    right:0;
    bottom:0;

    display:flex;
    align-items:center;
    justify-content:center;

    pointer-events:auto;
    z-index:5;
}

.empty-box{
    width:100%;
    max-width:360px;
    background:#ffffff;
    border-radius:18px;
    padding:22px 18px;
    text-align:center;

    box-shadow:
        0 10px 25px rgba(0,0,0,.08),
        0 2px 6px rgba(0,0,0,.05);
}

.empty-title{
    font-weight:700;
    font-size:16px;
    margin-bottom:10px;
    color:#111827;
}

.empty-text{
    font-size:15.5px;
    line-height:1.65;
    color:#4b5563;
    margin-bottom:18px;
}

.empty-btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:12px 18px;
    border-radius:999px;
    background:var(--brand);
    color:#fff;
    font-weight:600;
    font-size:14px;
    text-decoration:none;
}
</style>
  </head>

  <body>

    <div class="wrap">
      <div class="header">
        <div class="title">TDStudio ‚Äì H·ªó Tr·ª£ B·ªüi Bot</div>
        <div class="sub">Tr·ª±c 24/24 ¬∑ Fanpage ¬∑ Website ¬∑ Game</div>
      </div>

      <div id="chat" class="chat">
        <div id="emptyState" class="empty-popup">
          <div class="empty-box">
            <div class="empty-title">B·∫°n c√≥ th·ªÉ h·ªèi v·ªÅ:</div>

            <div class="empty-text">
              ‚Ä¢ Trang ch·ªß<br>
              ‚Ä¢ C·ªông ƒë·ªìng<br>
              ‚Ä¢ C√°ch t·∫£i game<br>
              ‚Ä¢ V·∫≠t ph·∫©m, item<br>
              ‚Ä¢ S·ª± ki·ªánm Giftcode<br>
              ‚Ä¢ H∆∞·ªõng d·∫´n k·ªπ thu·∫≠t<br>
              ‚Ä¢ Ch·ª©c nƒÉng, nhi·ªám v·ª•
            </div>

            <a class="empty-btn"
              href="https://www.facebook.com/tdstudiogame"
              target="_blank">
              üëâ Chat v·ªõi Admin Fanpage
            </a>
          </div>
        </div>
      </div>

      <div class="input">
        <input id="txt" placeholder="Nh·∫≠p n·ªôi dung c·∫ßn h·ªó tr·ª£‚Ä¶" />
        <button onclick="send()">G·ª≠i</button>
      </div>
    </div>

    <script>
const RULES_URL =
"https://raw.githubusercontent.com/kietsieudz/text/refs/heads/main/support_messenger.txt";
const MAX_REPLIES = 10;

let RULE_LINES = [];

fetch(RULES_URL)
  .then(r => r.text())
  .then(t => {
    RULE_LINES = t.split("\n").map(l => l.trim()).filter(Boolean);
  });

function normalize(s){
  return s.toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/\s+/g," ").trim();
}

function spin(text){
  while(true){
    const m = text.match(/\[([^\]]+)\]/);
    if(!m) return text;
    const opts = m[1].split("|");
    text = text.replace(m[0],
      opts[Math.floor(Math.random()*opts.length)]
    );
  }
}

function phraseMatch(text, kw){
  const r = new RegExp(`(^|\\W)${kw}(\\W|$)`);
  return r.test(text);
}

function parseBTN(reply){
  const lines = reply.split("\n").map(l=>l.trim()).filter(Boolean);
  if(!lines[0]?.startsWith("BTN:")) return null;

  const text = lines[1] || "";
  const buttons = [];

  for(let i=2;i<lines.length;i++){
    if(!lines[i].includes("=")) continue;
    const [title,url] = lines[i].split("=",2);
    if(url.startsWith("http")){
      buttons.push({title:title.trim(),url:url.trim()});
    }
  }
  return buttons.length ? {text,buttons} : null;
}

function addMsg(text,cls,buttons){
  document.getElementById("emptyState")?.remove();

  const d=document.createElement("div");
  d.className="msg "+cls;
  d.innerText=text;
  chat.appendChild(d);

  if(buttons){
    const b=document.createElement("div");
    b.className="buttons";
    buttons.forEach(btn=>{
      const a=document.createElement("a");
      a.href=btn.url;
      a.target="_blank";
      a.innerText=btn.title;
      b.appendChild(a);
    });
    chat.appendChild(b);
  }
  chat.scrollTop=chat.scrollHeight;
}

function send(){
  const text = txt.value.trim();
  if(!text) return;
  txt.value = "";

  addMsg(text, "user");

  const replies = matchRules(text);

  if(!replies.length){
    addMsg(
      "C√¢u h·ªèi n√†y em ch∆∞a r√µ üòÖ\nAnh mu·ªën g·∫∑p Admin ƒë·ªÉ h·ªèi tr·ª±c ti·∫øp kh√¥ng?",
      "bot",
      [{ title:"üëâ Chat v·ªõi Admin Fanpage", url:"https://www.facebook.com/tdstudiogame" }]
    );
    return;
  }

  replies.forEach(r=>{
    const btn = parseBTN(r);
    btn ? addMsg(btn.text,"bot",btn.buttons) : addMsg(r,"bot");
  });
}

function matchRules(input){
  const plain = normalize(input);
  const out = [];
  const seen = new Set();

  for(const line of RULE_LINES){
    if(out.length >= MAX_REPLIES) break;

    const idx = line.indexOf("|");
    if(idx === -1) continue;

    const keysPart = line.slice(0, idx);
    const replyRaw = line.slice(idx + 1);

    const keys = keysPart.split(",").map(k => normalize(k));

    if(keys.some(k => phraseMatch(plain, k))){
      let r = spin(replyRaw.replace(/\\n/g,"\n"));
      if(seen.has(r)) continue;
      seen.add(r);
      out.push(r);
    }
  }
  return out;
}
txt.addEventListener("keydown",e=>{
  if(e.key==="Enter") send();
});
</script>

  </body>
</html>
