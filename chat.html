<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Chat h·ªó tr·ª£ 1v1 Ng·ªçc R·ªìng Online | TDStudio</title>
<link rel="canonical" href="https://thanhdi.com/chat.html" />
<meta name="description"
      content="Trang chat h·ªó tr·ª£ 1v1 Ng·ªçc R·ªìng Online t·∫°i TDStudio.">

<style>
:root{
  --brand:#2563eb;
  --bg:#eef2f7;
  --card:#ffffff;
  --bot:#f1f5f9;
  --border:#e5e7eb;
  --text:#111827;
  --muted:#6b7280;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
}

/* ===== WRAP ===== */
.wrap{
  position:fixed;
  top:10%; bottom:10%; left:5%; right:5%;
  display:flex;
  flex-direction:column;
  background:var(--card);
  border-radius:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
  overflow:hidden;
}

/* ===== HEADER ===== */
.header{
  padding:14px 12px;
  background:linear-gradient(135deg,#020617,#0f172a);
  color:#fff;
  text-align:center;
}
.header .title{font-weight:700;font-size:15px}
.header .sub{font-size:12px;opacity:.8}

/* ===== CHAT ===== */
.chat{
  position:relative;
  flex:1;
  overflow-y:auto;
  padding:16px 12px;
  background:#f8fafc;
  display:flex;
  flex-direction:column;
}

/* ===== MESSAGE ===== */
.msg{
  max-width:82%;
  margin-bottom:6px;
  font-size:13.2px;
  line-height:1.45;
  word-wrap:break-word;
}

.msg.user{
  align-self:flex-end;
  background:var(--brand);
  color:#fff;
  padding:7px 12px;
  border-radius:16px 16px 4px 16px;
}

.msg.bot{
  align-self:flex-start;
  background:var(--bot);
  color:var(--text);
  padding:8px 12px;
  border-radius:16px 16px 16px 4px;
}

.msg.bot img{
  display:block;
  max-width:220px;
  border-radius:12px;
  margin-top:6px;
}

/* ===== EMPTY STATE ===== */
.empty-popup{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:5;
}

.empty-box{
  width:100%;
  max-width:360px;
  background:#fff;
  border-radius:18px;
  padding:22px 18px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.empty-title{
  font-weight:700;
  font-size:16px;
  margin-bottom:10px;
}

.empty-text{
  font-size:15.5px;
  line-height:1.65;
  color:#4b5563;
  margin-bottom:18px;
}

.empty-btn{
  display:inline-flex;
  padding:12px 18px;
  border-radius:999px;
  background:var(--brand);
  color:#fff;
  font-weight:600;
  text-decoration:none;
}

/* ===== INPUT ===== */
.input{
  display:flex;
  gap:8px;
  padding:10px;
  border-top:1px solid var(--border);
  background:#fff;
}

.input input{
  flex:1;
  border:1px solid var(--border);
  border-radius:999px;
  padding:12px 14px;
  font-size:14px;
}

.input button{
  border:none;
  background:var(--brand);
  color:#fff;
  padding:0 18px;
  border-radius:999px;
  font-weight:600;
}
</style>
</head>

<body>

<div class="wrap">
  <div class="header">
    <div class="title">TDStudio ‚Äì H·ªó Tr·ª£ B·ªüi Bot</div>
    <div class="sub">Tr·ª±c 24/24 ¬∑ Fanpage ¬∑ Website ¬∑ Game</div>
  </div>

  <div id="chat" class="chat">
    <div id="emptyState" class="empty-popup">
      <div class="empty-box">
        <div class="empty-title">B·∫°n c√≥ th·ªÉ h·ªèi v·ªÅ:</div>
        <div class="empty-text">
          ‚Ä¢ Trang ch·ªß<br>
          ‚Ä¢ C√°ch t·∫£i game<br>
          ‚Ä¢ H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t<br>
          ‚Ä¢ V·∫≠t ph·∫©m, item<br>
          ‚Ä¢ Ch·ª©c nƒÉng trong game<br>
          ‚Ä¢ Nhi·ªám v·ª•, ph·ª• b·∫£n<br>
          ‚Ä¢ S·ª± ki·ªán, giftcode<br>
          ‚Ä¢ L·ªói ƒëƒÉng nh·∫≠p, l·ªói game
        </div>
        <a class="empty-btn"
           href="https://www.facebook.com/tdstudiogame"
           target="_blank">
          üëâ Chat v·ªõi Admin Fanpage
        </a>
      </div>
    </div>
  </div>

  <div class="input">
    <input id="txt" placeholder="Nh·∫≠p n·ªôi dung c·∫ßn h·ªó tr·ª£‚Ä¶" />
    <button onclick="send()">G·ª≠i</button>
  </div>
</div>

<script>
const RULES_URL =
"https://raw.githubusercontent.com/kietsieudz/text/refs/heads/main/support_messenger.txt";
const MAX_REPLIES = 10;

let RULE_LINES = [];

fetch(RULES_URL)
  .then(r => r.text())
  .then(t => {
    RULE_LINES = t.split("\n").map(l => l.trim()).filter(Boolean);
  });

function normalize(s){
  return s.toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/\s+/g," ").trim();
}

/* ===== SPIN ===== */
function spin(text){
  while(true){
    const m = text.match(/\[([^\]]+)\]/);
    if(!m) return text;
    const opts = m[1].split("|").map(s=>s.trim()).filter(Boolean);
    text = text.replace(m[0],
      opts[Math.floor(Math.random()*opts.length)]
    );
  }
}

/* ===== AUTO LINK ===== */
function linkify(text){
  return text.replace(
    /(https?:\/\/[^\s]+)/g,
    '<a href="$1" target="_blank" style="color:#2563eb;text-decoration:underline">$1</a>'
  );
}

function phraseMatch(text, kw){
  return new RegExp(`(^|\\W)${kw}(\\W|$)`).test(text);
}

/* ===== PARSE IMG ===== */
function parseIMG(reply){
  const lines = reply.split("\n").map(l=>l.trim()).filter(Boolean);
  const imgs = [];
  const texts = [];

  for(const line of lines){
    if(line.startsWith("IMG:")){
      const url = line.slice(4).trim();
      if(url.startsWith("http")) imgs.push(url);
    }else{
      texts.push(line);
    }
  }
  return { text:texts.join("\n"), imgs };
}

function addText(text, cls){
  document.getElementById("emptyState")?.remove();
  const d = document.createElement("div");
  d.className = "msg " + cls;
  d.innerHTML = linkify(text).replace(/\n/g,"<br>");
  chat.appendChild(d);
}

function addImg(url){
  const wrap = document.createElement("div");
  wrap.className = "msg bot";
  const img = document.createElement("img");
  img.src = url;
  img.loading = "lazy";
  wrap.appendChild(img);
  chat.appendChild(wrap);
}

function send(){
  const text = txt.value.trim();
  if(!text) return;
  txt.value="";

  addText(text,"user");

  const replies = matchRules(text);

  if(!replies.length){
    addText(
      "C√¢u h·ªèi n√†y em ch∆∞a hi·ªÉu üòÖ\nAnh c√≥ th·ªÉ chat tr·ª±c ti·∫øp fanpage ƒë·ªÉ admin h·ªó tr·ª£ nh√©.",
      "bot"
    );
    chat.scrollTop = chat.scrollHeight;
    return;
  }

  replies.forEach(r=>{
    const { text, imgs } = parseIMG(r);
    if(text) addText(text,"bot");
    imgs.forEach(addImg);
  });

  chat.scrollTop = chat.scrollHeight;
}

/* ===== FIX SPLIT | ===== */
function matchRules(input){
  const plain = normalize(input);
  const out = [];
  const seen = new Set();

  for(const line of RULE_LINES){
    if(out.length >= MAX_REPLIES) break;

    const idx = line.indexOf("|");
    if(idx === -1) continue;

    const keysPart = line.slice(0, idx);
    const replyRaw = line.slice(idx + 1);

    const keys = keysPart.split(",").map(k=>normalize(k));

    if(keys.some(k=>phraseMatch(plain,k))){
      let r = spin(replyRaw.replace(/\\n/g,"\n"));
      if(seen.has(r)) continue;
      seen.add(r);
      out.push(r);
    }
  }
  return out;
}

txt.addEventListener("keydown",e=>{
  if(e.key==="Enter") send();
});
</script>

</body>
</html>